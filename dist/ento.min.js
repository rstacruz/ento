(function(t,e){if(typeof define==="function"&&define.amd){define(["underscore"],e)}else if(typeof exports==="object"){module.exports=e(n())}else{t.Ento=e(n())}function n(){try{return require("underscore")}catch(e){return t._}}})(this,function(t){if(!t)throw new Error("Ento: underscore.js not found.");var e;function n(){return e.extend()}var r=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t,e){if(t===null||typeof t==="undefined")return t;if(e===String)return""+t;if(e===Number)return+t;if(e===Date)return new Date(t);if(e===Boolean){if(typeof t==="string"){t=t.toLowerCase();if(t==="1"||t==="yes"||t==="true")return true;else if(t==="0"||t==="no"||t==="false"||t==="")return false}else if(typeof t==="number"){return t!==0}else{return!!t}}}})();return t.exports}();var i=function(){var t={exports:{}},e=t.exports;(function(){e.camelize=function(t){return t.trim().replace(/[-_\s]+(.)?/g,function(t,e){return e.toUpperCase()})};e.underscored=function(t){return t.trim().replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[\.-\s]+/g,"_").toLowerCase()}})();return t.exports}();var s=i.camelize;var o=i.underscored;n._=t;n.camelize=s;n.underscored=o;n.events=function(){var t={exports:{}},e=t.exports;(function(){var e=[].slice;t.exports=function(t){var n=t._;var r={on:function(t,e,n){if(!s(this,"on",t,[e,n])||!e)return this;this._events||(this._events={});var r=this._events[t]||(this._events[t]=[]);r.push({callback:e,context:n,ctx:n});return this},once:function(t,e,r){if(!s(this,"once",t,[e,r])||!e)return this;var i=this;var o=n.once(function(){i.off(t,o);e.apply(this,arguments)});o._callback=e;return this.on(t,o,r)},off:function(t,e,r){var i,o,u,a,f,c,h,l;if(!this._events||!s(this,"off",t,[e,r]))return this;if(!t&&!e&&!r){this._events=void 0;return this}a=t?[t]:n.keys(this._events);for(f=0,c=a.length;f<c;f++){t=a[f];if(u=this._events[t]){this._events[t]=i=[];if(e||r){for(h=0,l=u.length;h<l;h++){o=u[h];if(e&&e!==o.callback&&e!==o.callback._callback||r&&r!==o.context){i.push(o)}}}if(!i.length)delete this._events[t]}}return this},trigger:function(t){var n=e.call(arguments,1);return this.triggerFor(this,t,n)},triggerFor:function(t,e,n){if(!this._events)return this;if(!s(this,"trigger",e,n))return this;var r=this._events[e];var i=this._events.all;if(r)o(r,t,n);if(i)o(i,t,arguments);return this},stopListening:function(t,e,r){var i=this._listeningTo;if(!i)return this;var s=!e&&!r;if(!r&&typeof e==="object")r=this;if(t)(i={})[t._listenId]=t;for(var o in i){t=i[o];t.off(e,r,this);if(s||n.isEmpty(t._events))delete this._listeningTo[o]}return this}};var i=/\s+/;var s=function(t,e,n,r){if(!n)return true;if(typeof n==="object"){for(var s in n){t[e].apply(t,[s,n[s]].concat(r))}return false}if(i.test(n)){var o=n.split(i);for(var u=0,a=o.length;u<a;u++){t[e].apply(t,[o[u]].concat(r))}return false}return true};var o=function(t,e,n){var r,i=-1,s=t.length,o=n[0],u=n[1],a=n[2];switch(n.length){case 0:while(++i<s)(r=t[i]).callback.call(r.ctx||e);return;case 1:while(++i<s)(r=t[i]).callback.call(r.ctx||e,o);return;case 2:while(++i<s)(r=t[i]).callback.call(r.ctx||e,o,u);return;case 3:while(++i<s)(r=t[i]).callback.call(r.ctx||e,o,u,a);return;default:while(++i<s)(r=t[i]).callback.apply(r.ctx||e,n);return}};var u={listenTo:"on",listenToOnce:"once"};n.each(u,function(t,e){r[e]=function(e,r,i){var s=this._listeningTo||(this._listeningTo={});var o=e._listenId||(e._listenId=n.uniqueId("l"));s[o]=e;if(!i&&typeof r==="object")i=this;e[t](r,i,this);return this}});return r}})();return t.exports}()(n);n.persistence=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t){var e=t._;return function(t){t.on("init",function(){this.is.loading=false}).use({fetch:function(t){if(!this.api||!this.api.sync)throw new Error("fetch(): no api.sync");var e=this.api.sync;var r=this;n(r,{fetching:true,error:false});r.trigger("fetching");e("get",r,function(e,i){if(e){n(r,{fetching:false,error:e});r.trigger("error");if(t)t(e)}else{n(r,{fetching:false,loaded:true,error:false});r.set(i);r.trigger("load");if(t)t(e,i)}})},save:function(){},destroy:function(){}});function n(t,n){e.extend(t.is,n);t.trigger("change:is",t.is)}}}})();return t.exports}()(n);n.collection=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t){var e=t._;return function(t){t.attr("items");t.attr("length",["items"],function(){return this.items&&this.items.length||0});t.on("init",function(){this.raw.items=[]});t.use({setArray:function(t){this.set("items",t)},push:function(t){},pop:function(t){},shift:function(t){},unshift:function(t){},slice:function(){},at:function(t){return this.get("items")[t]}});var n=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];e.each(n,function(n){t.prototype[n]=function(){var t=[].slice.call(arguments);t.unshift(this.get("items")||[]);return e[n].apply(e,t)}})}}})();return t.exports}()(n);n.exportable=function(){var t={exports:{}},e=t.exports;(function(){t.exports={"export":function(){var t={};var e=this.constructor.attributes;for(var n in e){if(e.hasOwnProperty(n)){var r=e[n];if(r.enumerable!==false&&r.export!==false){t[n]=this[n]}}}t.is=this.is;return t}}})();return t.exports}();n.relations=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t){var e=t._;return function(e){e.hasOne=function(t,e,r){n(t,e,r,true);return this};e.belongsTo=function(t,e,i){n(t,e,i,false);r(t,e,i);return this};function n(n,r,i,s){n=t.camelize(n);e.attr(n,{set:function(t){var e,o=this;if(s)this.stopListening(e,"change");if(!t){this.raw[n]=undefined;return}if(typeof t!=="object")throw new Error("Ento.relation: not an object");if(t.constructor===Object)e=new r(t);else if(t instanceof r)e=t;else throw new Error("Ento.relation: not an instance of the given class");this.raw[n]=e;if(s){this.listenTo(e,"change",function(){o.trigger("change:"+n,o.get(n));o.trigger("change")})}if(i.as&&e[i.as]!==this)e[i.as]=this;return},json:s})}function r(n,r,i){n=t.camelize(n);var s=n+"Id";e.attr(s,{set:function(t){var e=this.get(n);if(!e||!e.id||e.id!==t)this.setOne(n,{id:t})},get:function(){var t=this.get(n);if(t)return t.id},json:true})}}}})();return t.exports}()(n);n.ractiveAdaptor=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t){return{filter:function(e,n,r){return e instanceof t.object},wrap:function(e,n,r,i){var s;n.on("change",function(t){if(t){s=true;e.set(i(n.get(t)))}else{e.update(r)}},e);return{get:function(){return n.get()},teardown:function(){n.off(null,null,e)},set:function(t,e){if(s){s=false;return}n.set(t,e)},reset:function(e){if(typeof e!=="object")throw new Error("Ento.ractiveAdaptor: not sure what to do");if(e instanceof t.object)return false;n.set(e)}}}}}})();return t.exports}()(n);var u=function(){var t={exports:{}},e=t.exports;(function(){var e=t.exports=function(){this.ltr={};this.rtl={}};e.prototype={add:function(t,e){var r=this.ltr,i=this.rtl;if(!r[t])r[t]={};n(e,function(e){if(!i[e])i[e]={};r[t][e]=true;i[e][t]=true})},dependencies:function(t){return this.traverse(this.ltr,t)},dependents:function(t){return this.traverse(this.rtl,t)},traverse:function(t,e){if(typeof e==="string")e=[e];var r={},i=this;n(e,function(e){r[e]=true;i.traverseKeys(r,t,e)});return Object.keys(r)},traverseKeys:function(t,e,r){var i=this;n(e[r],function(n,r){t[r]=i.traverseKeys(t,e,r)});return t}};function n(t,e){if(t)for(var n in t)if(t.hasOwnProperty(n))e(t[n],n)}})();return t.exports}();n.object=e=function(t){if(t!==false)return this.constructor.build.apply(this,arguments)};e.extended=function(){this.attributes={};this.deps=new u};e.extended();t.extend(e,n.events);e.ento=true;e.attr=function(e){var n=a.apply(this,arguments);e=s(e);this.attributes[e]=n;if(n.via)this.deps.add(e,n.via);var r=t.uniq([e,o(e)]);var i=function(t){this.setOne(e,t)};for(var u=0,f=r.length;u<f;u++){if(this.prototype[r[u]])continue;Object.defineProperty(this.prototype,r[u],{enumerable:n.enumerable,get:n.get,set:i})}return this};function a(e){var n={};n.name=e;for(var i=1,o=arguments.length;i<o;i++){var u=arguments[i];if(Array.isArray(u)){n.via=u}else if(typeof u==="object"){t.extend(n,u)}else if(~[Number,String,Date,Boolean].indexOf(u)){n.type=u}else if(typeof u==="function"){if(!n.get)n.get=u;else if(!n.set)n.set=u}}if(typeof n.enumerable==="undefined")n.enumerable=true;if(!n.get&&n.type)n.get=function(){return r(this.raw[e],n.type)};if(!n.get)n.get=function(){return this.raw[e]};if(!n.set)n.set=function(t){this.raw[e]=t};if(typeof n.via==="string")n.via=[n.via];if(n.via)n.via=n.via.map(s);return n}e.attributeNames=function(){return t.keys(this.attributes)};e.use=function(e,n){if(!e&&arguments.length===1){throw new Error("ento.use: invalid arguments")}else if(typeof e==="function"){e.call(this,this)}else if(typeof e==="object"){t.extend(this.prototype,e)}if(typeof n==="object"){t.extend(this,n)}return this};e.extend=function(){var t={exports:{}},e=t.exports;(function(){t.exports=function(t){return function(e,n){var r=this;var i;if(e&&t.has(e,"constructor")){i=e.constructor}else{i=function(){return r.apply(this,arguments)}}t.extend(i,r,n);var s=function(){this.constructor=i};s.prototype=r.prototype;i.prototype=new s;if(e)t.extend(i.prototype,e);i.__super__=r.prototype;if(typeof i.extended==="function")i.extended();return i}}})();return t.exports}()(t);e.use(n.events);e.use(n.exportable);e.api=function(t){if(!arguments.length)return this.prototype.api;this.prototype.api=t;return this};e.build=function(){var t,n,r;if(this instanceof e)r=this;else r=new this(false);if(arguments.length===2){t=arguments[0];n=arguments[1]}else{t=r.constructor.api();n=arguments[0]}Object.defineProperty(r,"raw",{value:{},enumerable:false});Object.defineProperty(r,"is",{value:{},enumerable:false});if(t)r.api=t;r.trigger("build",r);if(n)r.set(n);r.is.fresh=true;r.trigger("init",r);r.init(n);return r};e.use({init:function(t){},set:function(e,n,r){if(t.isArray(e)){if(!this.setArray)throw new Error("Ento.set: use Ento.collection to handle arrays");return this.setArray(e)}else if(typeof e==="object")return this.setMany(e,n);else return this.setOne(e,n,r)},setMany:function(t,e){if(!e)e={};e.nochange=true;for(var n in t)if(t.hasOwnProperty(n))this.setOne(n,t[n],{silent:true});if(!e||!e.silent)this.triggerChange(t)},setOne:function(t,e,n){var r=this;this.is.fresh=false;var i=this.constructor.attributes[t];if(i&&i.set)i.set.call(this,e);else this[t]=e;if(!n||!n.silent){var s={};s[t]=e;this.triggerChange(s)}},triggerChange:function(e){var n=this;var r=this.constructor.deps.dependents(t.keys(e));t.each(r,function(e){var r=t.uniq([e,o(e)]);t.each(r,function(t){n.trigger("change:"+t,t)})});n.trigger("change",r)},get:function(e){if(arguments.length===0)return this.export();if(Array.isArray(e))return this.getMany(e);else if(typeof e==="object")return this.getMany(t.keys(e));else return this.getOne(e)},getMany:function(e){var n={};var r=this;t.each(e,function(t){n[t]=r.get(t)});return n},getOne:function(t){var e=this.constructor.attributes[t];if(e)return e.get.apply(this);else return this[t]},trigger:function(t){n.events.trigger.apply(this,arguments);n.events.triggerFor.call(this.constructor,this,t,[].slice.call(arguments,1));return this},toJSON:function(){var e={};var n=this;t.each(this,function(t,n){e[n]=t});var r=this.constructor.attributes;t.each(r,function(t,r){if(t.json===false)return;e[r]=n[r]});return e}});n.version="0.0.1";return n});