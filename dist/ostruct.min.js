(function(t,e){if(typeof define==="function"&&define.amd){define(["underscore"],e)}else if(typeof exports==="object"){module.exports=e(r())}else{t.Ostruct=e(r())}function r(){try{return require("underscore")}catch(e){return t._}}})(this,function(t){if(!t)throw new Error("Ostruct: underscore.js not found.");var e;function r(){return e.extend()}r.events=function(){var t={exports:{}};(function(){var e=[].slice;t.exports=function(t){var r={on:function(t,e,r){if(!i(this,"on",t,[e,r])||!e)return this;this._events||(this._events={});var n=this._events[t]||(this._events[t]=[]);n.push({callback:e,context:r,ctx:r||this});return this},once:function(e,r,n){if(!i(this,"once",e,[r,n])||!r)return this;var s=this;var o=t.once(function(){s.off(e,o);r.apply(this,arguments)});o._callback=r;return this.on(e,o,n)},off:function(e,r,n){var s,o,f,a,u,c,h,l;if(!this._events||!i(this,"off",e,[r,n]))return this;if(!e&&!r&&!n){this._events=void 0;return this}a=e?[e]:t.keys(this._events);for(u=0,c=a.length;u<c;u++){e=a[u];if(f=this._events[e]){this._events[e]=s=[];if(r||n){for(h=0,l=f.length;h<l;h++){o=f[h];if(r&&r!==o.callback&&r!==o.callback._callback||n&&n!==o.context){s.push(o)}}}if(!s.length)delete this._events[e]}}return this},trigger:function(t){if(!this._events)return this;var r=e.call(arguments,1);if(!i(this,"trigger",t,r))return this;var n=this._events[t];var o=this._events.all;if(n)s(n,r);if(o)s(o,arguments);return this},stopListening:function(e,r,n){var i=this._listeningTo;if(!i)return this;var s=!r&&!n;if(!n&&typeof r==="object")n=this;if(e)(i={})[e._listenId]=e;for(var o in i){e=i[o];e.off(r,n,this);if(s||t.isEmpty(e._events))delete this._listeningTo[o]}return this}};var n=/\s+/;var i=function(t,e,r,i){if(!r)return true;if(typeof r==="object"){for(var s in r){t[e].apply(t,[s,r[s]].concat(i))}return false}if(n.test(r)){var o=r.split(n);for(var f=0,a=o.length;f<a;f++){t[e].apply(t,[o[f]].concat(i))}return false}return true};var s=function(t,e){var r,n=-1,i=t.length,s=e[0],o=e[1],f=e[2];switch(e.length){case 0:while(++n<i)(r=t[n]).callback.call(r.ctx);return;case 1:while(++n<i)(r=t[n]).callback.call(r.ctx,s);return;case 2:while(++n<i)(r=t[n]).callback.call(r.ctx,s,o);return;case 3:while(++n<i)(r=t[n]).callback.call(r.ctx,s,o,f);return;default:while(++n<i)(r=t[n]).callback.apply(r.ctx,e);return}};var o={listenTo:"on",listenToOnce:"once"};t.each(o,function(e,n){r[n]=function(r,n,i){var s=this._listeningTo||(this._listeningTo={});var o=r._listenId||(r._listenId=t.uniqueId("l"));s[o]=r;if(!i&&typeof n==="object")i=this;r[e](n,i,this);return this}});return r}})();return t.exports}()(t);r.persistence=function(){var e={exports:{}};(function(){e.exports={itemClass:null,exports:["state","error","fresh","items"],fetch:function(t){var e=this;e._setFetching();this.api.sync(this,"get",function(r,n){if(r){e._setError(r);if(t)t(r)}else{e._setData(n);if(t)t(null,e)}});return this},refetch:function(t){this.reset();return this.fetch(t)},_setFetching:function(){this.fresh=false;this.state="fetching";this.error=false;this.trigger("change")},_setError:function(t){this.fresh=false;this.state="error";this.error={status:t.status,message:t.message};this.trigger("change");this.trigger("error",t)},_setData:function(e){this.fresh=false;this.state="data";if(Array.isArray(e)){var r=this.itemClass;if(r)this.items=t.map(e,function(t){return new r(this,t)});else this.items=e}else{this.set(e)}this.trigger("change");this.trigger("data")},reset:function(){var t=this;t.fresh=true;if(t.props)t.props.forEach(function(e){if(t.hasOwnProperty(e)&&typeof t[e]!=="function"){delete t[e]}});if(t.items)t.items=[];t.trigger("change")}}})();return e.exports}();e=function(){var t,e;for(var r=0,n=arguments.length;r<n;r++){if(r===0&&arguments[0]&&arguments[0].sync){t=arguments[0]}else if(typeof arguments[r]==="object"&&!e){e=arguments[r]}}this.is={fresh:true};this.api=t;this.raw={};if(e)this.set(e);this.init(e)};e.prototype={init:function(t){},set:function(t,e){if(arguments.length===1&&typeof t==="object"){for(var r in t){if(t.hasOwnProperty(r))this.set(r,t[r])}return}this[t]=e},setRaw:function(t,e,r){this.raw[t]=e;this.trigger("change:"+t,e)}};e.extended=function(){this.properties={}};e.extended();e.attr=function(e){var r={};for(var o=1,f=arguments.length;o<f;o++){var a=arguments[o];if(typeof a==="object"){t.extend(r,a)}else if(a===Number||a===String||a===Date||a===Boolean){r.type=a}else if(typeof a==="function"){if(!r.get)r.get=a;else if(!r.set)r.set=a}}if(typeof r.enumerable==="undefined")r.enumerable=true;this.properties[e]=r;var u={enumerable:r.enumerable,get:r.get||(r.type?function(){return s(this.raw[e],r.type)}:null)||function(){return this.raw[e]},set:function(t){if(r.set){r.set.call(this,t);this.trigger("change:"+e,t)}else{this.setRaw(e,t)}}};var c=t.uniq([e,n(e),i(e)]);for(var o=0,f=c.length;o<f;o++){Object.defineProperty(this.prototype,c[o],u)}return this};e.propertyNames=function(){return t.keys(this.properties)};e.use=function(e,r){if(typeof e==="function"){e.call(this,this)}else if(typeof e==="object"){t.extend(this.prototype,e)}if(typeof r==="object"){t.extend(this,r)}return this};e.extend=function(){var t={exports:{}};(function(){t.exports=function(t){return function(e,r){var n=this;var i;if(e&&t.has(e,"constructor")){i=e.constructor}else{i=function(){return n.apply(this,arguments)}}t.extend(i,n,r);var s=function(){this.constructor=i};s.prototype=n.prototype;i.prototype=new s;if(e)t.extend(i.prototype,e);i.__super__=n.prototype;if(typeof i.extended==="function")i.extended();return i}}})();return t.exports}()(t);function n(t){return t.trim().replace(/[-_\s]+(.)?/g,function(t,e){return e.toUpperCase()})}function i(t){return t.trim().replace(/([a-z\d])([A-Z]+)/g,"$1_$2").replace(/[\.-\s]+/g,"_").toLowerCase()}function s(t,e){if(t===null||typeof t==="undefined")return t;if(e===String)return""+t;if(e===Number)return+t;if(e===Date)return new Date(t);if(e===Boolean){if(typeof t==="string"){t=t.toLowerCase();if(t==="1"||t==="yes"||t==="true")return true;else if(t==="0"||t==="no"||t==="false"||t==="")return false}else if(typeof t==="number"){return t!==0}else{return!!t}}}t.extend(e.prototype,r.events);r.object=e;return r});